<mxfile host="app.diagrams.net" modified="2022-04-04T01:21:19.593Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.60 Safari/537.36" etag="DIPq4UDSLDFLu5XjwWyc" version="17.3.0" type="github">
  <diagram id="p3raXml9qlwW9wQmed7t" name="Page-1">
    <mxGraphModel dx="782" dy="379" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="850" pageHeight="1100" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="JTCh8VayDwcOx7TlHHJk-20" value="&lt;h1&gt;VCenter Pre-Invoice Report&lt;/h1&gt;&lt;pre&gt;metering_utility.get_request_global_context&lt;br&gt;metering_utility.register_consumption_metrics&lt;br&gt;metering_utility.load_consumption_metrics&lt;br&gt;metering_utility.get_active_client_agreements&lt;br&gt;metering_utility.standardize_cm_columns&lt;br&gt;metering_utility.append_cm_reserve_rows&lt;br&gt;metering_utility.load_metrics_cpa&lt;br&gt;metering_utility.get_rate_parameter_sets&lt;br&gt;metering_utility.get_rps_source_columns&lt;br&gt;metering_utility.get_scheduled_thresholds&lt;br&gt;metering_utility.get_rate_schedules&lt;br&gt;metering_utility.get_rate_criteria&lt;br&gt;metering_utility.load_rps_rc_candidates&lt;br&gt;metering_utility.load_cm_rps_rc_matches&lt;br&gt;metering_utility.update_cm_std_augment_columns&lt;br&gt;metering_utility.update_cm_commit_augment_columns&lt;br&gt;metering_utility.load_rpt_fod_preinvoice&lt;/pre&gt;" style="text;html=1;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;fillColor=default;glass=1;shadow=1;sketch=1;" vertex="1" parent="1">
          <mxGeometry x="150" y="30" width="370" height="310" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-56" value="CALL metering_utility.job_requestor( &#39;Universal Invoice&#39;, 217631, 54013, NULL, &#39;ucc_vcenter.compute_combined_threshold&#39;)&lt;br&gt;p_request_job_id=54013&lt;br&gt;p_client_billing_period_id=16082" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;rounded=0;shadow=0;glass=1;sketch=0;fillColor=none;gradientColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="660" y="310" width="320" height="110" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-122" value="metering_utility.get_request_global_context" style="swimlane;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="380" width="570" height="300" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-126" value="get_request_job_detail" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-122">
          <mxGeometry x="40" y="40" width="140" height="110" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-127" value="p_request_id&#xa;v_job_id&#xa;v_parser_id,&#xa;v_status_id ..." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-126">
          <mxGeometry y="30" width="140" height="80" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-130" value="requests" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-122">
          <mxGeometry x="210" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-131" value="invoiceable_report_name" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-130">
          <mxGeometry y="30" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-134" value="ucc_contract.clients" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-122">
          <mxGeometry x="390" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-135" value="cl.client_type_id, &#xa;cl.client_name" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-134">
          <mxGeometry y="30" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-136" value="event_types" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-122">
          <mxGeometry x="210" y="130" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-137" value="event_type_name" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-136">
          <mxGeometry y="30" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-138" value="system_settings" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-122">
          <mxGeometry x="30" y="200" width="250" height="90" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-139" value="v_system_reserve_cap" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-138">
          <mxGeometry y="30" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-140" value="setting_name = &#39;EnableReserveCap&#39;" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-138">
          <mxGeometry y="60" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-142" value="parsers" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-122">
          <mxGeometry x="390" y="130" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-144" value="pr.parser_name" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-142">
          <mxGeometry y="30" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-146" value="parser_name null?" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#f8cecc;opacity=50;strokeColor=#b85450;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-122">
          <mxGeometry x="400" y="205" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-147" value="metering_utility.register_consumption_metrics-&gt; metering_utility.load_consumption_metrics" style="swimlane;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="720" width="570" height="160" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-148" value="tmp_consumption_metrics" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-147">
          <mxGeometry x="40" y="40" width="490" height="100" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-149" value="row_num, serial, dummy, processing_source, commit_row_num, &#xa;processing_source = &#39;Collection&#39; &#xa;&#xa;* Copy from ucc_vcenter.compute_combined_threshold table to tmp_consumption_metrics" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-148">
          <mxGeometry y="30" width="490" height="70" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-162" value="metering_utility.get_active_client_agreements" style="swimlane;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="920" width="570" height="350" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-163" value="ucc_contract.agreements" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-162">
          <mxGeometry x="30" y="80" width="200" height="220" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-164" value="    ag.client_id,&#xa;    ag.agreement_id,&#xa;    	ag.std_short_name as schedule,&#xa;    	ag.effective_date,&#xa;    	ag.effective_period,&#xa;    	ag.contract_period_months,&#xa;    	ag.total_nominal_capacity,&#xa;    	ag.agreement_type,&#xa;    	ag.basis_type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-163">
          <mxGeometry y="30" width="200" height="190" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-167" value="" style="endArrow=classic;html=1;rounded=0;fontSize=12;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="JTCh8VayDwcOx7TlHHJk-162" source="JTCh8VayDwcOx7TlHHJk-164" target="JTCh8VayDwcOx7TlHHJk-170">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="270" y="250" as="sourcePoint" />
            <mxPoint x="300" y="205" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-168" value="where" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;" vertex="1" connectable="0" parent="JTCh8VayDwcOx7TlHHJk-167">
          <mxGeometry x="-0.3714" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-169" value="metering_utility.get_product_agreement_by_cbp" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-162">
          <mxGeometry x="290" y="80" width="270" height="230" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-170" value="    ag.client_id,&#xa;    ag.agreement_id,&#xa;    	ag.std_short_name as schedule,&#xa;    	ag.effective_date,&#xa;    	ag.effective_period,&#xa;    	ag.contract_period_months,&#xa;    	ag.total_nominal_capacity,&#xa;    	ag.agreement_type,&#xa;    	ag.basis_type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-169">
          <mxGeometry y="30" width="270" height="140" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-175" value="cbp &gt;=  asset_product_agreements.start_period&#xa;cbp &lt;= asset_product_agreements.end_period&#xa;agreements.effective_period &lt;= v_billing_period" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-169">
          <mxGeometry y="170" width="270" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-172" value="CPA&lt;br&gt;client_product_agreements" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=none;gradientColor=#ffffff;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-162">
          <mxGeometry x="330" y="40" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-176" value="metering_utility.get_active_client_agreements" style="swimlane;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="1300" width="570" height="350" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-177" value="ucc_contract.agreements" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-176">
          <mxGeometry x="30" y="80" width="200" height="220" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-178" value="    ag.client_id,&#xa;    ag.agreement_id,&#xa;    	ag.std_short_name as schedule,&#xa;    	ag.effective_date,&#xa;    	ag.effective_period,&#xa;    	ag.contract_period_months,&#xa;    	ag.total_nominal_capacity,&#xa;    	ag.agreement_type,&#xa;    	ag.basis_type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-177">
          <mxGeometry y="30" width="200" height="190" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-179" value="" style="endArrow=classic;html=1;rounded=0;fontSize=12;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="JTCh8VayDwcOx7TlHHJk-176" source="JTCh8VayDwcOx7TlHHJk-178" target="JTCh8VayDwcOx7TlHHJk-182">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="270" y="250" as="sourcePoint" />
            <mxPoint x="300" y="205" as="targetPoint" />
            <Array as="points">
              <mxPoint x="260" y="200" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-180" value="&amp;nbsp; &amp;nbsp;Filter By" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;" vertex="1" connectable="0" parent="JTCh8VayDwcOx7TlHHJk-179">
          <mxGeometry x="-0.3714" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-181" value="metering_utility.get_product_agreement_by_cbp" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-176">
          <mxGeometry x="290" y="80" width="270" height="230" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-182" value="    ag.client_id,&#xa;    ag.agreement_id,&#xa;    	ag.std_short_name as schedule,&#xa;    	ag.effective_date,&#xa;    	ag.effective_period,&#xa;    	ag.contract_period_months,&#xa;    	ag.total_nominal_capacity,&#xa;    	ag.agreement_type,&#xa;    	ag.basis_type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-181">
          <mxGeometry y="30" width="270" height="140" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-183" value="cbp &gt;=  asset_product_agreements.start_period&#xa;cbp &lt;= asset_product_agreements.end_period&#xa;agreements.effective_period &lt;= v_billing_period" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-181">
          <mxGeometry y="170" width="270" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-184" value="CPA&lt;br&gt;client_product_agreements" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=none;gradientColor=#ffffff;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-176">
          <mxGeometry x="330" y="40" width="190" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-185" value="metering_utility.standardize_cm_columns" style="swimlane;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="1670" width="570" height="240" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-186" value="tmp_agreements" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-185">
          <mxGeometry x="30" y="50" width="250" height="170" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-195" value="agreement_type" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=none;gradientColor=#ffffff;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-186">
          <mxGeometry y="30" width="250" height="40" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-196" value="&lt;span&gt;WHEN agreement_type = &#39;FlexOnDemand&#39;&amp;nbsp; &amp;nbsp; or agreement_type = &#39;CommitBased&#39;&lt;/span&gt;&lt;br&gt;&lt;span&gt;THEN &#39;MeteringReportFodStandardInvoice&#39;&lt;/span&gt;&lt;br&gt;&lt;span&gt;WHEN agreement_type = &#39;ManagedServices&#39;&amp;nbsp;&amp;nbsp; &amp;nbsp;or agreement_type = &#39;DatacenterUtility&#39;&lt;/span&gt;&lt;br&gt;&lt;span&gt;THEN &#39;StandardInvoice&#39;&lt;/span&gt;" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#d5e8d4;opacity=50;strokeColor=#82b366;align=left;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-186">
          <mxGeometry y="70" width="250" height="100" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-197" value="tmp_consumption_metrics" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-185">
          <mxGeometry x="290" y="90" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-198" value="add a couple of standard universal columns&#xa;add the contract-specific augment columns" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-197">
          <mxGeometry y="30" width="260" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-199" value="metering_utility.append_cm_reserve_rows" style="swimlane;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="1940" width="570" height="240" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-200" value="tmp_agreements" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-199">
          <mxGeometry x="30" y="50" width="250" height="120" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-201" value="agreement_type" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=none;gradientColor=#ffffff;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-200">
          <mxGeometry y="30" width="250" height="40" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-202" value="v_agreement_type = &#39;FlexOnDemand&#39; or v_agreement_type = &#39;CommitBased&#39;" style="rounded=0;whiteSpace=wrap;html=1;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#d5e8d4;opacity=50;strokeColor=#82b366;align=left;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-200">
          <mxGeometry y="70" width="250" height="50" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-203" value="tmp_consumption_metrics" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-199">
          <mxGeometry x="290" y="90" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-204" value="Commit rows are re-inserted as Reserve rows" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-203">
          <mxGeometry y="30" width="260" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-205" value="metering_utility.load_metrics_cpa" style="swimlane;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="2240" width="590" height="300" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-209" value="get_product_agreement_by_cbp" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-205">
          <mxGeometry x="310" y="35" width="270" height="230" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-215" value="    ag.client_id,&#xa;    ag.agreement_id,&#xa;    	ag.std_short_name as schedule,&#xa;    	ag.effective_date,&#xa;    	ag.effective_period,&#xa;    	ag.contract_period_months,&#xa;    	ag.total_nominal_capacity,&#xa;    	ag.agreement_type,&#xa;    	ag.basis_type" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-209">
          <mxGeometry y="30" width="270" height="140" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-216" value="cbp &gt;=  asset_product_agreements.start_period&#xa;cbp &lt;= asset_product_agreements.end_period&#xa;agreements.effective_period &lt;= v_billing_period" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-209">
          <mxGeometry y="170" width="270" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-211" value="client_product_agreements" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-205">
          <mxGeometry x="40" y="30" width="200" height="220" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-212" value="cpa.asset_id,&#xa;		cpa.schedule,&#xa;		cpa.resource_family,&#xa;		cpa.resource_category_id,&#xa;		cpa.standard_capacity_metric_id,&#xa;		cpa.capacity_metric,&#xa;		cpa.resource_category,&#xa;		cpa.product_agreement_id,&#xa;		cpa.asset_product_agreement_id,&#xa;		cpa.agreement_id," style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-211">
          <mxGeometry y="30" width="200" height="190" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-213" value="" style="endArrow=classic;html=1;rounded=0;fontSize=12;entryX=0;entryY=0.419;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="JTCh8VayDwcOx7TlHHJk-205" target="JTCh8VayDwcOx7TlHHJk-215">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="240" y="125" as="sourcePoint" />
            <mxPoint x="390" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-214" value="where" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;" vertex="1" connectable="0" parent="JTCh8VayDwcOx7TlHHJk-213">
          <mxGeometry x="-0.3333" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-217" value="metering_utility.get_rate_parameter_sets" style="swimlane;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="2590" width="590" height="210" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-218" value="product_agreement_rate_parameters" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-217">
          <mxGeometry x="300" y="70" width="270" height="100" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-219" value="rps.rate_parameter_set_id &#xa;= parp.rate_parameter_set_id" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-218">
          <mxGeometry y="30" width="270" height="70" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-221" value="rate_parameter_sets" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-217">
          <mxGeometry x="20" y="30" width="220" height="150" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-222" value="  rps.db_object_name as report_name&#xa;	   , parp.product_agreement_id&#xa;	   , rps.rate_parameter_set_id&#xa;	   , rps.db_object_name&#xa;	   , rps.resource_category_id&#xa;	   , rps.billable_column&#xa;	   , rps.billable_metric_id" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-221">
          <mxGeometry y="30" width="220" height="120" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-223" value="" style="endArrow=classic;html=1;rounded=0;fontSize=12;entryX=0;entryY=0.419;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="JTCh8VayDwcOx7TlHHJk-217" target="JTCh8VayDwcOx7TlHHJk-219">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="240" y="129" as="sourcePoint" />
            <mxPoint x="390" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-224" value="where" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;" vertex="1" connectable="0" parent="JTCh8VayDwcOx7TlHHJk-223">
          <mxGeometry x="-0.3333" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-225" value="metering_utility.get_rps_source_columns" style="swimlane;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="40" y="2840" width="590" height="240" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-226" value="rate_parameter_sets" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-225">
          <mxGeometry x="360" y="40" width="140" height="80" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-227" value="resource_category_id" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-226">
          <mxGeometry y="30" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-228" value="rate_parameter_source_columns" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-225">
          <mxGeometry x="20" y="30" width="280" height="180" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-229" value="   rps.db_object_name as report_name&#xa;	  , parp.product_agreement_id&#xa;	  , rps.resource_category_id&#xa;	  , rpsc.rate_parameter_set_id&#xa;  , rpsc.rate_parameter_source_column_id&#xa;	  , rpsc.feature_id&#xa;	  , rpsc.feature_value_column" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-228">
          <mxGeometry y="30" width="280" height="120" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-233" value="feature: resource_category, resource_type, asset" style="text;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-228">
          <mxGeometry y="150" width="280" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-230" value="" style="endArrow=classic;html=1;rounded=0;fontSize=12;entryX=0.007;entryY=0.271;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="JTCh8VayDwcOx7TlHHJk-225" target="JTCh8VayDwcOx7TlHHJk-227" source="JTCh8VayDwcOx7TlHHJk-229">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="240" y="129" as="sourcePoint" />
            <mxPoint x="390" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-231" value="where" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;" vertex="1" connectable="0" parent="JTCh8VayDwcOx7TlHHJk-230">
          <mxGeometry x="-0.3333" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-234" value="product_agreement_rate_parameters" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-225">
          <mxGeometry x="360" y="130" width="210" height="80" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-235" value="product_agreement_id" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;rounded=0;shadow=0;glass=1;sketch=0;fontSize=12;opacity=50;" vertex="1" parent="JTCh8VayDwcOx7TlHHJk-234">
          <mxGeometry y="30" width="210" height="50" as="geometry" />
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-236" value="" style="endArrow=classic;html=1;rounded=0;fontSize=12;entryX=0.019;entryY=0.207;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="JTCh8VayDwcOx7TlHHJk-225" source="JTCh8VayDwcOx7TlHHJk-229" target="JTCh8VayDwcOx7TlHHJk-235">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="320" y="156.44999999999982" as="sourcePoint" />
            <mxPoint x="380.98" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JTCh8VayDwcOx7TlHHJk-237" value="where" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=12;" vertex="1" connectable="0" parent="JTCh8VayDwcOx7TlHHJk-236">
          <mxGeometry x="-0.3333" y="-1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
